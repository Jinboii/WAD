<!DOCTYPE html>
<html>
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>

<div id="message"></div>
<img id="imgsrc">

<form id="form1" action="upload.php" method="post" enctype="multipart/form-data">
  Select image to upload:
  <input type="file" name="fileToUpload" id="fileToUpload">
  <input type="submit" value="Upload Image" name="submit">
</form>
<div id="form2"></div>

</body>

<script>
  var html_link =  window.location.href;

  //Check if its an update or initial upload
  if (html_link.search("listing_id")>0) {
    var listing_id_position = html_link.search("listing_id") + 11;
    var listing_id = html_link.substr(listing_id_position);
  
    let getlisting_url = "getlisting.php";
    let para = {listingid : listing_id} ; 

    // Use Axios to call API asynchronously
    axios.get(getlisting_url, {params:para}) 
    .then(response => {
        var listing = response.data[0];
        var image = listing.image;

        //#use same image button
        var button_same = document.createElement("a");
        button_same.setAttribute("class","btn btn-primary");
        var data_url_same = "create.html".concat("?listing_id=",listing_id,"&upload=",image);
        button_same.setAttribute("href",data_url_same);
        var samebuttontext = document.createTextNode("Use back this image!");
        button_same.appendChild(samebuttontext);
                        
        document.getElementById("message").appendChild(button_same);
        document.getElementById("imgsrc").src = "uploads/".concat(image);

        document.getElementById("form1").setAttribute("class","d-none");
        document.getElementById("form2").innerHTML = `<form id="form1" action="upload.php?listingid=${listing_id}" 
                              method="post" enctype="multipart/form-data">
                              Select image to upload:
                              <input type="file" name="fileToUpload" id="fileToUpload">
                              <input type="submit" value="Upload Image" name="submit">
                              </form>`;
    })
    .catch(error => {
        console.log(error.message);
    }) 
  }
</script>
</html>